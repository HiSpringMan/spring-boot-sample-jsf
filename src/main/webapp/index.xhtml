<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<f:view contentType="text/html"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:p="http://primefaces.org/ui"
    xmlns:local="http://xmlns.jcp.org/jsf/component">
<html>

<h:head>
  
  <!-- For Bootstrap responsive grid -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
  
</h:head>

<h:body>

<h:form id="form">

  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <p:messages globalOnly="true" />
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <p:panel header="Form" styleClass="form-horizontal">
          <div class="form-group">
            <p:outputLabel value="Field value" for="field" styleClass="col-sm-3 control-label" />
            <div class="col-sm-9">
              <p:inputText id="field" value="#{formBean.field}" pt:placeholder="Input a value" required="true">
                <f:validateLength minimum="2" />
              </p:inputText>
              <p:messages for="field" />
            </div>
          </div>
        
          <div class="form-group">
            <div class="col-sm-offset-3 col-sm-9">
              <p:commandButton value="Submit" action="#{formController.submit}" ajax="false"
                  icon="fa fa-save" />
              <p:commandButton value="Reset (Ajax)" actionListener="#{formController.reset}" update="@form"
                  icon="fa fa-trash" immediate="true" />
              <p:button value="Go to home" outcome="/index" 
                  icon="fa fa-home" />
            </div>
          </div>          
          
        </p:panel>
      </div>
      
      <div class="col-md-6">
        <p:panel header="Submitted values saved in view scope">
          <p:dataList value="#{formBean.submittedValues}" var="value" type="ordered">
            #{value}
          </p:dataList>
        </p:panel>
      </div>


    </div>

    <div class="row">
      <div class="col-md-6">
        <!-- < local :predicateEditor  / >-->
      </div>
    </div>

    <div class="row">
      <div>
        <p:panel id="pe" header="Predicate Editor">
          <table>
            <tr>
              <th style="width: 160px">Field</th>
              <th style="width: 160px">Oper</th>
              <th style="width: 260px">Value</th>
              <th style="width: 160px">Actions</th>
            </tr>
            <ui:repeat id="rep" value="#{formBean.criteria}" var="criterion">
              <tr>
                <td>
                  <p:selectOneMenu id="fld" value="#{criterion.field}" style="width: 140px">
                    <f:selectItems value="#{formBean.getFields(criterion)}" />
                    <p:ajax process="@this" update=":form:pe" />
                  </p:selectOneMenu>
                </td>

                <td>
                  <p:selectOneMenu id="oper" value="#{criterion.oper}" style="width: 120px">
                    <f:selectItems value="#{formBean.getOperations(criterion)}" />
                    <p:ajax process="@this" update=":form:pe" />
                  </p:selectOneMenu>
                </td>

                <td>
                  <!--
                    Folgende Idee fÃ¼r diesen Bereich:

                    < pe:valueEditor id="ve" criterion="criterion" / >
                    Diese Komponente leitet von ganz normal h:inputText ab,
                    und erweitert diese dynamisch um Validatoren und Converter,
                    rendert auch bedingt ein Kalendar-Icon.

                  -->

                  <h:inputText id="vl" value="#{criterion.value}" />
                  <!-- < local:predicateValueEditor criterion="#{criterion}" /> -->

                  <p:commandButton actionListener="#{formBean.openLookup(criterion)}" value="L" process=":form:pe" update=":form:pe"
                                   rendered="#{formBean.isHasLookup(criterion)}"
                  />
                </td>
                <td>
                  <p:commandButton actionListener="#{formBean.addCriterionAfter(criterion)}" value="+" process=":form:pe" update=":form:pe" />
                  <p:commandButton actionListener="#{formBean.removeCriterion(criterion)}" value="X" process=":form:pe" update=":form:pe" immediate="true" />
                </td>
              </tr>
            </ui:repeat>

            <p:dialog header="Basic Dialog" widgetVar="dlg1" minHeight="40" modal="true" visible="#{formBean.lookupDialogVisible}">
              <h:inputText id="dlgvl" value="#{formBean.lookupDialogValue}" />
              <p:commandButton actionListener="#{formBean.selectLookupValues()}" value="OK" process=":form:pe" update=":form:pe" />
            </p:dialog>
          </table>
        </p:panel>
      </div>

    </div>

  </div>

</h:form>
</h:body>

</html>
</f:view>