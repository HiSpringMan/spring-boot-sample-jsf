<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:composite="http://java.sun.com/jsf/composite"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

<head><title>Predicate Editor</title></head>
<body>

<composite:interface>
    <composite:attribute name="model" type="org.acme.sample.predicateeditor.PredicateEditorModel" />
    <composite:attribute name="dataProvider" type="org.acme.sample.predicateeditor.PredicateEditorDataProvider" />
</composite:interface>

<composite:implementation>
    <h:panelGroup id="panel" layout="block">
    <table>
        <tr>
            <th style="width: 80px">Link</th>
            <th style="width: 160px">Field</th>
            <th style="width: 160px">Oper</th>
            <th style="width: 260px">Value</th>
            <th style="width: 200px">Actions</th>
        </tr>
        <ui:repeat id="rep" value="#{cc.attrs.model.criteria}" var="criterion">
            <tr>
                <td>
                    <h:outputText value="#{criterion.link}" />
                </td>

                <td>
                    <p:selectOneMenu id="fld" value="#{criterion.field}" style="width: 140px">
                        <f:selectItems value="#{predicateEditor.getFields(cc)}" />
                        <p:ajax process="@this" update=":#{cc.clientId}:panel" />
                    </p:selectOneMenu>
                </td>

                <td>
                    <p:selectOneMenu id="oper" value="#{criterion.oper}" style="width: 120px">
                        <f:selectItems value="#{predicateEditor.getOperations(cc, criterion)}" />
                        <p:ajax process="@this" update=":#{cc.clientId}:panel" />
                    </p:selectOneMenu>
                </td>

                <td>
                    <!--
                      Folgende Idee fÃ¼r diesen Bereich:

                      < pe:valueEditor id="ve" criterion="criterion" / >
                      Diese Komponente leitet von ganz normal h:inputText ab,
                      und erweitert diese dynamisch um Validatoren und Converter,
                      rendert auch bedingt ein Kalendar-Icon.

                    -->

                    <h:inputText id="vl" value="#{criterion.value}" />
                    <!-- < local:predicateValueEditor criterion="#{criterion}" /> -->

                    <p:commandButton actionListener="#{predicateEditor.openLookup(cc, criterion)}" value="L"
                                     process=":#{cc.clientId}:panel" update=":#{cc.clientId}:panel"
                                     rendered="#{predicateEditor.hasLookupValues(cc, criterion)}"
                    />
                </td>
                <td>
                    <p:commandButton actionListener="#{predicateEditor.addCriterionAfter(cc, criterion, 'AND')}" value="AND"
                                     process=":#{cc.clientId}:panel" update=":#{cc.clientId}:panel" />
                    <p:commandButton actionListener="#{predicateEditor.addCriterionAfter(cc, criterion, 'OR')}" value="OR"
                                     process=":#{cc.clientId}:panel" update=":#{cc.clientId}:panel" />
                    <p:commandButton actionListener="#{predicateEditor.removeCriterion(cc, criterion)}" value="X"
                                     process=":#{cc.clientId}:panel" update=":#{cc.clientId}:panel" immediate="true" />
                </td>
            </tr>
        </ui:repeat>

        <p:dialog header="Lookup Dialog" widgetVar="#{cc.clientId}_dlg1" minHeight="40" modal="true"
                  visible="#{cc.attrs.model.lookupDialogVisible}" closeOnEscape="true" dynamic="true">
            <p:ajax event="close" listener="#{cc.attrs.value.lookupDialogClosed}" />

            <p:pickList id="lookupPickList" value="#{cc.attrs.model.lookupModel}" var="lookupItem"
                        itemValue="#{lookupItem}" itemLabel="#{lookupItem}"
                        showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains">

                <f:facet name="sourceCaption">Available</f:facet>
                <f:facet name="targetCaption">Selected</f:facet>

                <!--
                <p:column style="width:30%">
                    <h:outputText value="#{lookupItem}" />
                </p:column>

                <p:column style="width:70%;">
                    <h:outputText value="#{lookupItem}" />
                </p:column>
                -->

            </p:pickList>

            <p:commandButton actionListener="#{predicateEditor.selectLookupValues(cc)}" value="OK"
                             process=":#{cc.clientId}:panel" update=":#{cc.clientId}:panel" />
        </p:dialog>
    </table>
    </h:panelGroup>

</composite:implementation>

</body>
</html>